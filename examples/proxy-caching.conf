# Example: Proxy Caching Configuration
# Demonstrates proxy cache settings and cache control

events {
    worker_connections 1024;
}

http {
    # Proxy cache configuration
    proxy_cache_path /var/cache/nginx 
                     levels=1:2 
                     keys_zone=STATIC:10m 
                     inactive=24h 
                     max_size=1g 
                     use_temp_path=off;
    
    proxy_cache_key "$scheme$request_method$host$request_uri";
    
    # Cache for API responses
    proxy_cache_path /var/cache/nginx/api 
                     levels=2 
                     keys_zone=API:5m 
                     inactive=1h 
                     max_size=500m;
    
    upstream backend {
        server 192.168.1.100:8080;
    }
    
    server {
        listen 80;
        server_name example.com;
        
        location /static {
            proxy_pass http://backend;
            proxy_cache STATIC;
            proxy_cache_valid 200 302 1h;
            proxy_cache_valid 404 1m;
            proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
            proxy_cache_lock on;
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        location /api {
            proxy_pass http://backend;
            proxy_cache API;
            proxy_cache_valid 200 5m;
            proxy_cache_valid 404 1m;
            proxy_cache_bypass $arg_nocache;
            proxy_no_cache $arg_nocache;
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        location /purge {
            proxy_cache_purge STATIC $scheme$request_method$host$request_uri;
        }
    }
}
